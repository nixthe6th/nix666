#!/bin/bash
# nixstat - Project statistics and commit tracking
# Usage: nixstat [month|year|all]

PERIOD="${1:-month}"

echo "âš¡ nix666 Stats"
echo "=============="
echo ""

# Commit counts by period
case "$PERIOD" in
    month)
        SINCE=$(date -d "$(date +%Y-%m-01)" +%Y-%m-%d 2>/dev/null || date -v1d +%Y-%m-%d)
        LABEL="This Month"
        ;;
    year)
        SINCE="$(date +%Y)-01-01"
        LABEL="This Year"
        ;;
    all|*)
        SINCE=""
        LABEL="All Time"
        ;;
esac

if [ -n "$SINCE" ]; then
    COMMITS=$(git log --since="$SINCE" --oneline 2>/dev/null | wc -l)
    echo "ðŸ“Š Commits ($LABEL): $COMMITS"
else
    COMMITS=$(git rev-list --count HEAD 2>/dev/null)
    echo "ðŸ“Š Total Commits: $COMMITS"
fi

# Monthly target progress
if [ "$PERIOD" = "month" ]; then
    TARGET=50
    PCT=$(( COMMITS * 100 / TARGET ))
    echo "   ðŸŽ¯ Target: $TARGET | Progress: $PCT%"
    
    # Simple bar
    FILLED=$(( PCT / 5 ))
    EMPTY=$(( 20 - FILLED ))
    BAR=$(printf '%*s' "$FILLED" '' | tr ' ' 'â–ˆ')
    SPACE=$(printf '%*s' "$EMPTY" '' | tr ' ' 'â–‘')
    echo "   [$BAR$SPACE]"
fi

echo ""
echo "ðŸ“ Files: $(find . -type f -not -path './.git/*' | wc -l)"
echo "ðŸ”§ Scripts: $(ls scripts/ 2>/dev/null | wc -l)"
echo "ðŸ“ Script LOC: $(find scripts/ -type f -exec cat {} \; 2>/dev/null | wc -l)"

# Recent activity
echo ""
echo "ðŸ• Recent Activity:"
git log --oneline -5 --no-decorate 2>/dev/null | sed 's/^/   /' || echo "   No git history"
